<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Dashboard</title>
  <style>
    :root{--accent:#6c63ff;--muted:#f3f4f6;--card:#ffffff}
    body{font-family:Inter,Segoe UI,Arial;background:#f6f7fb;margin:0}
    .wrap{display:flex;min-height:100vh}
    .sidebar{width:240px;background:#fff;padding:24px;border-right:1px solid #eee}
    .logo{font-weight:700;color:var(--accent);margin-bottom:24px}
    .nav a{display:block;padding:10px 6px;color:#374151;text-decoration:none;border-radius:8px}
    .nav a.active{background:var(--muted);color:#111}
    .main{flex:1;padding:28px}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    .card{background:var(--card);padding:18px;border-radius:10px;box-shadow:0 1px 2px rgba(0,0,0,0.04)}
    .card h3{margin:0;font-size:12px;color:#6b7280}
    .card .num{font-size:28px;margin-top:8px}
    .section{margin-top:22px}
    .table{background:#fff;padding:12px;border-radius:8px}
    pre{white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <aside class="sidebar">
      <div class="logo">ReservaSimple</div>
      <nav class="nav">
        <a class="active" href="#">Inicio</a>
        <a href="#">Calendario</a>
        <a href="#">Servicios</a>
        <a href="#">Barberos</a>
        <a href="#">Configuración</a>
      </nav>
    </aside>

    <main class="main">
      <div class="header">
        <h1>Panel Admin</h1>
        <div>
          <small id="slugLabel">Barbería: <strong>test</strong></small>
        </div>
      </div>

      <div class="cards">
        <div class="card">
          <h3>Turnos de Hoy</h3>
          <div class="num" id="turnosHoy">—</div>
        </div>
        <div class="card">
          <h3>Cancelaciones Hoy</h3>
          <div class="num" id="cancelHoy">—</div>
        </div>
        <div class="card">
          <h3>Turnos Pendientes</h3>
          <div class="num" id="turnosPend">—</div>
        </div>
        <div class="card">
          <h3>Comprobantes Pendientes</h3>
          <div class="num" id="comprobantes">—</div>
        </div>
      </div>

      <div class="section">
        <div class="card table">
          <h3>Últimas Cancelaciones</h3>
          <div id="cancelList">No hay cancelaciones recientes</div>
        </div>
      </div>

      <div class="section">
        <div class="card table">
          <h3>Servicios</h3>
          <div id="serviciosList">Cargando...</div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // Demo: usa el slug 'test' por defecto. Puedes cambiarlo dinámicamente.
    const SLUG = 'test';

    async function fetchJson(url, opts){
      try{
        const r = await fetch(url, opts);
        if(!r.ok) throw new Error(r.status + ' ' + r.statusText);
        return await r.json();
      }catch(e){console.warn('fetch error',url,e);return null}
    }

    async function load(){
      // Servicios
      const servicios = await fetchJson(`/b/${SLUG}/servicios`);
      if(servicios){
        const el = document.getElementById('serviciosList');
        el.innerHTML = servicios.map(s=>`<div><strong>${s.nombre}</strong> — ${s.duracion_minutos} min — $${s.precio}</div>`).join('');
        document.getElementById('turnosHoy').textContent = '—';
        document.getElementById('turnosPend').textContent = '—';
        document.getElementById('cancelHoy').textContent = '—';
      } else {
        document.getElementById('serviciosList').textContent = 'Error cargando servicios';
      }

      // Barberos count
      const barberos = await fetchJson(`/b/${SLUG}/barberos`);
      if(barberos) document.getElementById('turnosPend').textContent = barberos.length;

      // Agenda (turnos) demo: obtener turnos por fecha
      const today = new Date().toISOString().slice(0,10);
      const agenda = await fetchJson(`/b/${SLUG}/agenda?fecha=${today}`);
      if(Array.isArray(agenda)){
        document.getElementById('turnosHoy').textContent = agenda.length;
      }

      // Cancelaciones demo: (no specific endpoint) show placeholder
      document.getElementById('cancelList').textContent = 'No hay cancelaciones recientes';
    }

    load();
  </script>
</body>
</html>
